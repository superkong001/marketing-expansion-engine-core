# Marketing Expansion Engine (Core)

基于**统计特征（非明细数据）**进行客群差异挖掘与可解释规则组合，输出字段阈值与枚举条件，
供统计人员在后台拉取用户清单，用于营销扩展触达。

------------------------------------------------------------------------

## 一、项目定位

本项目适用于：

-   只有"全量客群 vs 圈定客群"的字段统计结果
-   无法获取用户级明细数据
-   目标是输出"可执行规则"而非训练黑盒模型

输出结果为：

-   连续字段阈值区间
-   离散字段枚举集合
-   3 条规则组合（k=3）的可解释营销扩展方案

------------------------------------------------------------------------

## 二、系统架构

### Stage1：差异特征挖掘

功能：

-   连续特征差异计算（均值、分位数、IQR、CV 等）
-   单侧尾部阈值推荐（避免常态区间）
-   离散特征差异与推荐类别集合
-   输出字段级差异结果

输出：

-   numeric_diff\_{cohort}\_{date}.csv
-   categorical_diff\_{cohort}\_{date}.csv

------------------------------------------------------------------------

### Stage2：营销扩展规则引擎

功能：

1.  生成原子规则（单字段阈值 / 枚举条件）
2.  估计规则覆盖率 / 提升度 / 精度
3.  Beam Search 生成 k=3 规则组合
4.  基于覆盖与精度约束筛选组合
5.  输出多组推荐营销扩展方案

输出：

-   atomic_rules\_{cohort}\_{date}.csv/json
-   candidate_segments\_{cohort}\_{date}.csv/json
-   segment_portfolio\_{cohort}\_{date}.json

------------------------------------------------------------------------

## 三、使用方法

### 1. Stage1

``` bash
python run_stage1.py   --stat-date 202510   --full-dir ./data/full_stats   --cohort-dir ./data/cohort_stats   --output-dir ./data/stage1_output
```

### 2. Stage2

``` bash
python run_stage2.py   --stat-date 202510   --cohort-name sub   --stage1-output-dir ./data/stage1_output   --output-dir ./data/stage2_output
```

------------------------------------------------------------------------

## 四、关键配置说明（config.json）

### 1）覆盖率控制（控制名单规模）

-   max_base_cov：单条规则最大覆盖率
-   max_combo_cov_est：组合规则最大覆盖率
-   min_sub_cov：单条规则最小圈定覆盖

### 2）精度控制（控制误触率）

-   expected_cohort_ratio：圈定占比（必须正确填写）
-   min_combo_precision：组合最小估计精度

### 3）结构控制（可解释性）

-   max_features_per_segment：组合规则条数（建议 3）
-   require_exact_k：是否只输出严格 k 条规则

------------------------------------------------------------------------

## 五、设计原则

1.  只使用统计数据，不依赖明细样本
2.  优先使用"尾部阈值"，避免常态区间
3.  强调小覆盖 + 高浓度组合
4.  输出多组方案供营销选择
5.  所有规则必须可解释、可执行

------------------------------------------------------------------------

## 六、重要说明

本项目不是分类模型，不以 ROC/AUC 为目标。

优化方向是：

-   更小的组合覆盖率
-   更高的估计精度
-   更低的误触率
-   更强的业务可解释性

最终营销效果需在线上或抽样回流验证。

------------------------------------------------------------------------

## 七、适用场景

-   携号转网用户扩展
-   新产品订购用户扩展
-   宽带订购用户扩展
-   风险类客群识别扩展
-   其他基于统计对比的营销扩展场景

------------------------------------------------------------------------

## 八、项目目标

构建一个：

> 可解释、可执行、可控规模、可控浓度的统计驱动营销扩展引擎
